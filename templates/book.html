{% extends "layout.html" %}
{% block title %}Book-info{% endblock %}

{% block head %}
     {{ super() }}
{% endblock %}

{% block content %}

    {{ super() }}


    <div class="book-info clearfix">
        <div class="photo">
            <img src="{{ img_url }}" alt="">
        </div>

        <div class="info">
        {% if description %}
            <h2>{{ book_title }}</h2>
            <p>{{ book_author }}</p>
            <p>ISBN: {{ isbn }}, Publication year: {{ year }}</p><br>
            <p>{{ description.replace(']]>','') }}</p><br>
        {% else %}
            <h4>There is no description available</h4><br>
        {% endif %}
            <h4>Rating</h4><br>
            <p>The book rating on goodreads is <strong>{{ rating }}</strong> - {{ count }} ratings</p>
            <p>The total rating is <strong>{{ total_rate }}</strong></p><br>
        {% if login_session %}
            <h5>Rate The Book</h5>
            <div class="rate">
                <a><span title="1" class="fa fa-star"></span></a>
                <a><span title="2" class="fa fa-star"></span></a>
                <a><span title="3" class="fa fa-star"></span></a>
                <a><span title="4" class="fa fa-star"></span></a>
                <a><span title="5" class="fa fa-star"></span></a>
            </div>

            <div class="rating">
                {% if user_rate == 1 %}
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=1)}}"><span title="n1" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=2)}}"><span title="n2" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=3)}}"><span title="n3" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=4)}}"><span title="n4" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=5)}}"><span title="n5" class="fa fa-star"></span></a>
                {% elif user_rate == 2 %}
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=1)}}"><span title="n1" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=2)}}"><span title="n2" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=3)}}"><span title="n3" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=4)}}"><span title="n4" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=5)}}"><span title="n5" class="fa fa-star"></span></a>
                {% elif user_rate == 3 %}
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=1)}}"><span title="n1" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=2)}}"><span title="n2" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=3)}}"><span title="n3" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=4)}}"><span title="n4" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=5)}}"><span title="n5" class="fa fa-star"></span></a>
                {% elif user_rate == 4 %}
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=1)}}"><span title="n1" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=2)}}"><span title="n2" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=3)}}"><span title="n3" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=4)}}"><span title="n4" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=5)}}"><span title="n5" class="fa fa-star"></span></a>
                {% elif user_rate == 5 %}
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=1)}}"><span title="n1" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=2)}}"><span title="n2" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=3)}}"><span title="n3" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=4)}}"><span title="n4" class="fa fa-star checked"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=5)}}"><span title="n5" class="fa fa-star checked"></span></a>
                {% else %}
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=1)}}"><span title="n1" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=2)}}"><span title="n2" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=3)}}"><span title="n3" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=4)}}"><span title="n4" class="fa fa-star"></span></a>
                <a href="{{url_for('rate', user_id=login_session, book_id = book_id, value=5)}}"><span title="n5" class="fa fa-star"></span></a>
                {% endif %}
            </div><br>
        {% endif %}

        <div class="comments">
            <h4>Comments</h4><br>
            {% if comments %}
                {% for comment in comments %}
                    <p><strong>{{ comment.name }}</strong></p>
                    <p>{{ comment.coment }}</p><br>
                {% endfor %}
            {% endif %}

            {% if login_session %}
                <form  action="{{url_for('comment', book_id=book_id, user_id=login_session)}}" method="post">
                    <input type="text" class="form-control" name="name" placeholder="Write a comment">
                    <input type="submit" class="btn btn-primary mt-2 mb-4" value="post">
                </form>
            {% endif %}
        </div>

        </div>

    </div>



        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', () => {
                const div = document.getElementsByClassName('rate');
                console.log(div);
                div[0].addEventListener('click', function(e) {

                    // console.log(e.target.title);
                    // console.log(div[0].children);
                    var rating = parseInt(e.target.title)
                    var book_id = {{ book_id }}
                    // console.log(book_id);
                    console.log([...Array(rating).keys()]);



                    $.ajax({
                        type: "POST",
                        url: '/book-rate',
                        data: {
                            rating: rating,
                            book_id: book_id
                        },
                        success: function(response)
                            {
                                // alert('HHHHHHHHHHH')
                                // alert(response['rate'])
                                // alert(response['book_id'])
                                // on the server side let the function return jsonify({"rate": rating})
                                var x = response['rate']
                                alert(x)
                                var rating_array = [...Array(x).keys()]
                                alert(rating_array.length);
                                for (var i = 0; i < rating_array.length; i++) {
                                    console.log(rating_array[i]);
                                    console.log(div[0].children[i]);
                                    div[0].children[i].firstChild.className += ' checked';

                                }
                                return false
                            }
                      });
                      return false

            })

            });

        </script>

{% endblock %}
