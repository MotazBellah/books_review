<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title></title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <h5>Rate The Book</h5>
        <div class="rate">
            <a><span title="1" class="fa fa-star checked"></span></a>
            <a><span title="2" class="fa fa-star checked"></span></a>
            <a><span title="3" class="fa fa-star"></span></a>
            <a><span title="4" class="fa fa-star"></span></a>
            <a><span title="5" class="fa fa-star"></span></a>
        </div>

        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', () => {

                // create function to check if the user submit a ratring or not 

                const div = document.getElementsByClassName('rate');
                console.log(div);
                div[0].addEventListener('click', function(e) {

                    console.log(e.target.title);
                    // console.log(div[0].children);
                    var rating = parseInt(e.target.title)
                    // console.log(div[0.]);
                    console.log([...Array(rating).keys()]);


                    $.ajax({
                        type: "POST",
                        url: '/rate-book',
                        data: {
                            rating: rating
                        },
                        success: function(response)
                            {
                                // on the server side let the function return jsonify({"rate": rating})
                                var x = response['rate']
                                var rating_array = [...Array(x).keys()]
                                for (var i = 0; i < rating_array.length; i++) {
                                    rating_array[i]
                                    console.log(div[0].children[i]);
                                    div[0].children[i].firstChild.className += ' checked';
                                }

                            }
                      });


                    // div[0].children.map(i => {
                    //     count = 0
                    //     while (count < rating) {
                    //         console.log(i);
                    //         count += 1
                    //     }
                    //
                    // })

                });

                // for (var i = 0; i < div.length; i++) {
                //     div[i].addEventListener('click', function (e) {
                //         titles = ['n1', 'n2', 'n3', 'n4', 'n5']
                //         console.log(this.children);
                //         if (titles.indexOf(e.target.title) != -1) {
                //             var c = this.children;
                //             console.log(c);
                //             for (var i = 0; i < c.length; i++) {
                //                 if(c[i].children[0].title <= e.target.title) {
                //                     console.log(c[i].children[0].title);
                //                     c[i].children[0].className += ' checked';
                //                 }
                //
                //             }
                //         }
                //     })
                // }
            })
            // div.addEventListener('click', (e) => {
            //     // console.log(e.target.type);
            //     titles = ['n1', 'n2', 'n3', 'n4', 'n5']
            //     if (titles.indexOf(e.target.title) != -1) {
            //         var c = div.children;
            //         console.log(c);
            //         for (var i = 0; i < c.length; i++) {
            //             if(c[i].children[0].title <= e.target.title) {
            //                 console.log(c[i].children[0].title);
            //                 c[i].children[0].className += ' checked';
            //             }
            //
            //         }
            //     }
            //     alert(e.target.title);
                // Check which star is clicked according to its title
                // set checked class to all pervios seblings
            // });
            // alert('h');
        </script>

    </body>
</html>
